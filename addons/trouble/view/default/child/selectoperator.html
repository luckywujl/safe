{layout name="common/layoutselect" /}
<style data-render="style">
    .example {
        height: 100%;
        position: relative;
    }

    .example>span {
        position: absolute;
        right: 10px;
        top: 10px;
    }

    .fixed-table-container {
        border: none !important;
    }
    .widget-user .widget-user-image {
        top: 70px;
    }
    .widget-user-2 .widget-user-image>img {
        width: 30px !important;
        height: 30px !important;
    }

    .fc-event-main {
        cursor: pointer;
    }

    .attachment-block {
        border: none;
        padding: 5px;
        margin-bottom: 10px;
        background: #ffffff;
    }

    .breadcrumb {
        padding: 0px 0px;
        margin-bottom: 0px;
        list-style: none;
        background-color: transparent !important;
        border-radius: 3px;
        line-height: 40px;
    }

    .table-template {
        height: 770px;
    }

    .fixed-table-pagination {
        margin: 0px 15px;
    }

    .tab-badge>.badge {
        display: inline-block;
        min-width: 10px;
        padding: 2px 5px;
        font-size: 7px !important;
        font-weight: normal !important;
        color: #fff;
        line-height: 1;
        vertical-align: middle;
        white-space: nowrap;
        text-align: center;
        background-color: #777777;
        border-radius: 10px;
        position: absolute;
        top: 0px;
        right: -2px;
    }

    .description-header {
        font-size: 24px !important;
    }
</style>
<div class="container-fluid" id="content-container">
    <div class="row">  
        <div class="col-md-12 connectedSortable">
                  <table id="table" class="table table-striped table-hover" width="100%"></table>
      
        </div>
        <div class="form-group">
        				<label class="control-label col-xs-12 col-sm-4"></label>
        				<div class="col-xs-12 col-sm-8">
            			<button type="button" class="btn btn-success btn-ok">{:__('确定')}</button>
        				</div>
    				</div>
        
    </div>
</div>

    <script id="itemtpl" type="text/html">
    <!--
    如果启用了templateView,默认调用的是itemtpl这个模板，可以通过设置templateFormatter来修改
    在当前模板中可以使用三个变量(item:行数据,i:当前第几行,data:所有的行数据)
    此模板引擎使用的是art-template的native,可参考官方文档
    -->

    <div class="col-sm-12 col-md-2">
        <!--下面四行是为了展示随机图片和标签，可移除-->
        <% var imagearr = ['https://cdn.fastadmin.net/uploads/addons/blog.png', 'https://cdn.fastadmin.net/uploads/addons/cms.png', 'https://cdn.fastadmin.net/uploads/addons/vote.png', 'https://cdn.fastadmin.net/uploads/addons/blog.png', 'https://cdn.fastadmin.net/uploads/addons/alisms.png']; %>
        <% var image = imagearr[item.id % 5]; %>
        <% var labelarr = ['primary', 'success', 'info', 'danger', 'warning']; %>
        <% var label = labelarr[item.main_status % 3]; %>
        <div class="thumbnail example">
            <span class="btn btn-<%=label%>">编号:<%=item.main_code%></span>
            <!--<img src="<%=image%>" style="width:100%;" alt="<%=item.title%>">-->
            <div class="caption">
                <h4><%=item.trouble_expression?item.trouble_expression:'无'%></h4>
                <!--<p class="text-muted">描述:<%=item.description%></p>-->
                <p class="text-muted">创建时间:<%=Moment(item.createtime*1000).format("YYYY-MM-DD HH:mm:ss")%></p>
                <p class="text-muted">隐患点:<%=item.point_name%>(<%=item.point_address%>)</p>
                <p>              
                    <a href="#" class="btn btn-success btn-open-course" data-id="<%=item.id%>" ><i class="fa fa-list-ol"></i>详情</a> 
                    <a href="#" class="btn btn-danger btn-dispatch" data-id="<%=item.id%>"><i class="fa fa-fa"></i>派单</a>
                    <span class="pull-right" style="margin-top:10px;"><%=item.trouble_type%></span>
                </p>
            </div>
        </div>
    </div>
</script>
    <script data-render="script">
        require.callback = function() {
            define('training/index', ['jquery', 'bootstrap', 'frontend','backend', 'table', 'fullcalendar-lang', 'fullcalendar', 'moment', 'moment/locale/zh-cn', 'panelslider','form','layer'], function($, undefined, Frontend, Backend,Table, CalendarLocale, Calendar, Moment, undefined, panelslider,Form,Layer) {
                 var table = null;
                var category_id = '#';
                var Controller = {
                    selectoperator: function() {
                        $('#tablist a[data-toggle="tab"]').on('shown.bs.tab', function(e) {
                            table.bootstrapTable('refresh', {})
                        });
                        // 初始化表格参数配置
                        Table.api.init({
                            extend: {
                                index_url: "{:addon_url('trouble/index/selectoperator')}"
                            }
                        });
                        table = $("#table");
                        Template.helper("Moment", Moment);
                        // 初始化表格
                        table.bootstrapTable({
                            url: $.fn.bootstrapTable.defaults.extend.index_url,
                            sortName: 'id',
                            classes: 'table',
                            //是否启用模板渲染
                            //templateView: true,
                            //数据格式化的模板ID或格式函数
                            //templateFormatter: "itemtpl",
                            //添加的父类的class
                            templateParentClass: "timeline",
                            //向table添加的class
                            templateTableClass: "table-template",
                            
                            
                            columns: [
                                [{
                                        field: 'state',
                                        checkbox: true,
                                    }, {
                                        field: 'jobnumber',
                                        title: '工号',
                                        operate: false,
                                    },
                                    {
                                        field: 'nickname',
                                        title: '姓名',
                                        operate: false
                                    },
                                    //直接响应搜索
                                    
                                ],
                            ],
                            //禁用默认搜索
                            search: false,
                            //启用普通表单搜索
                            commonSearch: false,
                            //可以控制是否默认显示搜索单表,false则隐藏,默认为false
                            searchFormVisible: false,
                            //分页大小
                            pageSize: 8,
                            pageList: [8],
                            showColumns: false,
                            showToggle: false,
                            showExport: false,
                        });
                        // 为表格绑定事件
                        Table.api.bindevent(table);
                       
                        Controller.api.bindEvents();
                    },
                    
                    api: {  
                        bindEvents() {
                           $(document).on("click", ".btn-ok", function() {
                            var ids = Table.api.selectedids(table);
                            Fast.api.close(ids);//将选中的值返回给调用者
                           });
                        }
                    }
                };
                return Controller;
            });
        }
    </script>
